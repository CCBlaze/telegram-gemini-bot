<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FusionGPT üí° - –í–µ–±-—á–∞—Ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –°—Ç–∏–ª—å –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏, —á—Ç–æ–±—ã —Å–∫—Ä—ã—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
        .chat-messages {
            max-height: 500px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .chat-messages::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4" style="font-family: 'Inter', sans-serif;">

    <div class="chat-container bg-white rounded-xl shadow-2xl w-full max-w-md flex flex-col h-[80vh] min-h-[500px]">
        
        <div class="chat-header bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 rounded-t-xl text-center shadow-lg">
            <h1 class="text-2xl font-bold">FusionGPT üí°</h1>
            <p class="text-sm opacity-80">–í–∞—à –ø–æ–º–æ—â–Ω–∏–∫ –Ω–∞ –±–∞–∑–µ Google Gemini</p>
        </div>

        <div id="chatbox" class="chat-messages flex-grow p-4 space-y-4">
            <div class="flex justify-start">
                <div class="message ai-message bg-gray-200 text-gray-800 p-3 rounded-xl max-w-[80%] shadow-md">
                    –ü—Ä–∏–≤–µ—Ç! –Ø FusionGPT, –∑–∞–¥–∞–π—Ç–µ –º–Ω–µ –≤–æ–ø—Ä–æ—Å, –∏ —è –æ—Ç–≤–µ—á—É –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!
                </div>
            </div>
            </div>

        <div class="chat-input flex p-4 border-t border-gray-200 bg-gray-50 rounded-b-xl">
            <input type="text" id="userInput" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-150">
            <button onclick="sendMessage()" class="ml-3 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full font-semibold shadow-lg transition duration-150 transform hover:scale-105 active:scale-95">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                    <path d="M3.478 2.405a.75.75 0 0 0-.926.94l2.432 7.173H10.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.173a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.405Z" />
                </svg>
            </button>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function appendMessage(text, isUser, isTemporary = false) {
            const chatbox = document.getElementById('chatbox');
            const messageWrapper = document.createElement('div');
            messageWrapper.className = isUser ? 'flex justify-end' : 'flex justify-start';
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message p-3 rounded-xl max-w-[80%] shadow-md ${isUser ? 'user-message bg-blue-500 text-white' : 'ai-message bg-gray-200 text-gray-800'}`;
            messageDiv.textContent = text;
            
            if (isTemporary) {
                messageDiv.id = 'loading-indicator';
            }

            messageWrapper.appendChild(messageDiv);
            chatbox.appendChild(messageWrapper);
            chatbox.scrollTop = chatbox.scrollHeight; // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            return messageDiv;
        }

        async function sendMessage() {
            const inputField = document.getElementById('userInput');
            const userText = inputField.value.trim();
            if (userText === '') return;

            // 1. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            appendMessage(userText, true);
            
            // 2. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É –¥–ª—è –ò–ò
            inputField.value = ''; // –û—á–∏—Å—Ç–∏—Ç—å –≤–≤–æ–¥
            inputField.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –≤–≤–æ–¥
            const loadingMsgElement = appendMessage('FusionGPT –ø–µ—á–∞—Ç–∞–µ—Ç...', false, true);

            // *** –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–û–ë–ê–í–õ–ï–ù –ü–û–õ–ù–´–ô –ê–î–†–ï–° RENDER ***
            // –í–∞–º –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –Ω–∞ —Å–≤–æ–π!
            const RENDER_URL = 'https://telegram-gemini-bot-b3x4.onrender.com';
            // **********************************************

            try {
                // 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä Render, –∏—Å–ø–æ–ª—å–∑—É—è –ø–æ–ª–Ω—ã–π URL
                const response = await fetch(RENDER_URL + '/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: userText })
                });

                const data = await response.json();
                
                // 4. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–ª—É—à–∫—É —Å –æ—Ç–≤–µ—Ç–æ–º –ò–ò
                loadingMsgElement.textContent = data.response;
                loadingMsgElement.classList.remove('bg-gray-200');
                loadingMsgElement.classList.add('bg-gray-100'); // –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
                loadingMsgElement.removeAttribute('id'); // –£–¥–∞–ª—è–µ–º ID –∑–∞–≥–ª—É—à–∫–∏

            } catch (error) {
                loadingMsgElement.textContent = '–û—à–∏–±–∫–∞: –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º.';
                console.error('Fetch error:', error);
                
            } finally {
                inputField.disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –≤–≤–æ–¥
                inputField.focus(); // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                document.getElementById('chatbox').scrollTop = document.getElementById('chatbox').scrollHeight;
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ Enter
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
                sendMessage();
            }
        });
    </script>
</body>
</html>
